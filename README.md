# 2025大创项目 - 农村女性就业市场MFG模拟系统

**项目名称**: 基于平均场博弈的农村女性就业市场动态模拟研究
**项目类型**: 大学生创新创业训练计划
**负责人**: 李心泠
**指导教师**: 李三希、林琳
**研究方向**: 劳动经济学、平均场博弈、计算经济学

---

## 项目概述

本项目旨在构建一个基于平均场博弈(MFG)理论与基于主体建模(ABM)方法的农村女性就业市场动态模拟系统，探究个体努力决策与宏观市场状态的相互作用机制，并为就业促进政策提供量化分析工具。

**核心研究问题**:

1. 农村女性如何动态调整努力水平以提高就业机会？
2. 个体决策与宏观市场状态如何相互作用形成均衡？
3. 如何设计最优政策组合以促进农村女性就业？

**数据来源**: CHARLS（中国健康与养老追踪调查）

---

## 项目结构

```
2025DaChuang/
├── Project/                    # 数据处理和分析
│   ├── Data/                  # 原始数据和清洗数据
│   └── Data_Analysis/         # 数据分析脚本和报告
│
├── Simulation_project/         # 第一版模拟系统（已停止）
│   └── modules/               # 初始模块设计
│
├── Simulation_project_v2/      # 第二版模拟系统（已废弃）
│   ├── src/                   # 源代码（过度设计）
│   ├── docs/                  # 文档（详细但复杂）
│   └── tests/                 # 测试代码
│
├── Simulation_project_v3/      # 第三版模拟系统（当前版本）
│   ├── MODULES/               # 5个核心模块
│   ├── CONFIG/                # 配置文件
│   ├── DATA/                  # 预处理数据
│   ├── OUTPUT/                # 输出结果
│   ├── DOCS/                  # 项目文档
│   └── TESTS/                 # 测试脚本（15个）
│
├── Others/                     # 辅助工具和分析脚本
├── venv/                      # Python虚拟环境
├── requirements.txt           # 项目依赖
└── activate_env.bat           # 环境激活脚本
```

---

## 开发历程

### 第一阶段：数据处理（2024年8月-9月）

**主要工作**:

- CHARLS数据清洗和预处理
- 变量编码和题目对应表建立
- 描述性统计分析
- 分布估计和独立性检验

**产出**:

- `Project/Data/` - 清洗后的数据集
- `Project/Data_Analysis/` - 分布推断和相关性分析报告

**关键发现**:

- 劳动力特征变量之间存在显著相关性
- 需要使用Copula理论建模联合分布
- 企业特征可采用多元正态分布假设

---

### 第二阶段：系统v1开发

**目录**: `Simulation_project/`

**设计目标**:

- 建立基础的人口分布模块
- 实现简单的匹配机制
- 探索MFG理论实现方法

**开发状态**: 部分完成后停止

**停止原因**:

- 架构设计不够清晰
- 模块职责划分不明确
- 缺少详细的需求文档

**经验教训**:

- 需要先确定清晰的架构再开发
- 必须遵循严格的开发规范
- 文档先行，代码后行

---

### 第三阶段：系统v2开发

**目录**: `Simulation_project_v2/`

**设计理念**: 追求学术级的完美实现

**技术特点**:

- 深层目录嵌套（src/core/modules）
- 稀疏网格离散化状态空间
- 多层抽象设计
- 详尽的文档系统（academic/developer/user）

**开发成果**:

- 完整的模块划分（5个核心模块）
- 详细的技术文档（19个文档）
- Numba性能优化探索
- 完整的测试框架

**主要问题**:

1. **过度复杂**: 目录结构过深，理解困难
2. **过度设计**: 稀疏网格等高级技术增加实现难度
3. **开发缓慢**: 复杂度导致开发效率低下
4. **维护困难**: 抽象层过多，难以定位问题

**废弃原因**:

- 偏离"简洁实用"的项目原则
- 复杂度超出研究需要
- 开发周期过长，影响项目进度

**保留价值**:

- 完整的理论研究和文档
- Numba优化经验
- 测试框架设计思路
- 参数设定的文献参考

---

### 第四阶段：系统v3开发

**目录**: `Simulation_project_v3/`

**开发状态**: 核心模块已完成，收敛性优化中

**设计理念**: 简洁、清晰、实用优先

**核心改进**:

1. **扁平化结构**: 顶层MODULES，无多余嵌套
2. **简化实现**: 基于个体的蒙特卡洛，放弃稀疏网格
3. **模块化设计**: 5个模块职责清晰，依赖明确
4. **严格规范**: PEP8代码规范，完整中文注释

---

## 当前进度（v3版本）

### 已完成模块（60%）

#### 1. POPULATION（人口分布）- 100%

**功能**:

- 劳动力分布建模（Gaussian Copula + 经验分布）
- 企业分布参数配置（四维正态分布）
- 参数保存和加载

**关键技术**:

- 连续变量（T, S, D, W, age）使用Copula建模
- 离散变量（education, children）使用经验分布
- 分布参数保存为pickle格式

**测试状态**: 通过（test_population.py）

---

#### 2. LOGISTIC（匹配与匹配函数）- 100%

**功能**:

- 虚拟市场生成（从分布采样）
- GS匹配算法（Numba加速）
- 匹配函数回归（Logit模型）

**关键技术**:

- Numba JIT加速偏好计算（3-5倍加速）
- MinMax标准化解决偏好集中度问题
- 双重MinMax标准化计算sigma指标

**参数调优**:

- max_rounds: 10 → 32（匹配率提升到50%）
- 离职率标准化（消除两极分化）
- 匹配函数自变量简化（12个 → 6个）

**测试状态**: 通过（7个测试脚本）

---

#### 3. MFG（平均场博弈）- 85%

**功能**:

- Bellman方程求解器（值迭代）
- KFE演化求解器（人口分布演化）
- 均衡求解器（交替迭代主控制）

**关键技术**:

- Numba JIT + parallel加速（10-30倍）
- 双层架构：Numba核心 + Python包装
- 基于个体的蒙特卡洛（N=10000）
- 动态MinMax标准化（S和D变量）

**核心算法**:

- 值迭代算法（最大500次）
- 蒙特卡洛人口演化
- Bellman + KFE交替迭代

**当前问题**: 收敛性待优化

- 价值函数震荡（|ΔV| = 5000-10000）
- 迭代100轮未收敛
- 宏观稳定（失业率4-5%）但微观不稳定

**优化措施**（2024-10-17实施）:

1. 降低贴现因子：ρ = 0.85 → 0.75
2. 添加阻尼更新：damping_factor = 0.3
3. 使用相对收敛阈值：ε_V = 0.01（1%）

**测试状态**: 功能正常，收敛性验证中

---

### 待开发模块（40%）

#### 4. SIMULATOR（模拟器）- 0%

**规划功能**:

- 市场模拟主程序
- 政策分析器（培训、补贴等）
- 批量场景运行
- 反事实分析

**依赖**: MFG模块稳定收敛

---

#### 5. CALIBRATION（参数校准）- 0%

**规划功能**:

- SMM（模拟矩匹配）校准器
- 遗传算法参数优化
- 目标矩定义和匹配

**依赖**: SIMULATOR模块完成

---

## 技术特色

### 性能优化

| 模块        | 优化技术         | 加速比 |
| ----------- | ---------------- | ------ |
| LOGISTIC    | Numba JIT        | 3-5x   |
| MFG Bellman | Numba + parallel | 10-30x |
| MFG KFE     | Numba + parallel | 10-30x |

### 核心算法

1. **Gaussian Copula建模**: 处理多维相关性
2. **Gale-Shapley稳定匹配**: 双边市场匹配
3. **Logit回归**: 匹配函数估计
4. **值迭代**: Bellman方程求解
5. **蒙特卡洛模拟**: 人口分布演化

### 参数调优成果

| 参数       | 调优前   | 调优后       | 改善              |
| ---------- | -------- | ------------ | ----------------- |
| max_rounds | 10       | 32           | 匹配率 29% → 50% |
| 离职率分布 | 中位数0% | 中位数2.94%  | 消除两极分化      |
| 偏好函数   | 未标准化 | MinMax标准化 | 各因素平衡        |

---

## 开发规范

### 代码规范

- PEP8 Python编码标准
- 完整的中文注释
- 文档字符串（docstring）
- 类型提示（type hints）

### 项目管理

- Git版本控制
- Change_Log.md详细记录（18次修改）
- 模块化设计
- 配置文件化（YAML）

### 测试覆盖

- 单元测试：各模块功能测试
- 集成测试：模块间接口测试
- 性能测试：Numba加速验证
- 当前：15个测试脚本

---

## 环境配置

### 系统要求

- Python 3.10+
- Windows 10/11（开发环境）
- 4GB+ RAM
- 多核CPU（Numba并行）

### 依赖库

```
numpy>=1.26.0          # 数值计算
pandas>=2.0.0          # 数据处理
scipy>=1.11.0          # 科学计算
numba>=0.59.0          # JIT加速（关键）
copulas>=0.12.0        # Copula建模
statsmodels>=0.14.0    # Logit回归
pyyaml>=6.0            # 配置文件
matplotlib>=3.8.0      # 可视化
```

### 环境激活

```bash
# Windows PowerShell
D:\Python\2025DaChuang\venv\Scripts\Activate.ps1

# Windows CMD
D:\Python\2025DaChuang\activate_env.bat
```

---

## 项目文档

### v3核心文档

- **README.md**: 项目说明
- **Change_Log.md**: 18次修改详细记录
- **用户需求确认文档.md**: 753行详细设计文档
- **KFE实现方法说明.md**: KFE求解器技术文档
- **MFG值函数修正方案.md**: 值函数计算方法

### v2参考文档

- **开发者文档**: 15个技术文档
- **学术文档**: 4个理论文档
- **用户文档**: 4个使用指南
- **研究计划**: 原始研究计划和理论基础

---

## 研究成果

### 技术创新

1. **简化的MFG实现**: 基于个体的蒙特卡洛方法，避免状态空间离散化
2. **Numba全面应用**: 核心计算10-30倍加速
3. **标准化方法**: 解决离职率两极分化和偏好集中度问题
4. **参数调优**: 系统的参数调优方法论

### 方法论贡献

1. **迭代开发**: v1 → v2 → v3的演化过程
2. **简洁原则**: 从过度设计回归实用主义
3. **文档先行**: 详细的需求文档指导开发
4. **测试驱动**: 15个测试脚本保证质量

---

## 下一步计划

### 短期（1-2天）

1. 验证MFG收敛性优化效果
2. 完成MFG模块测试和文档
3. 准备SIMULATOR模块开发

### 中期（1周）

1. 开发SIMULATOR模块
2. 实施初步政策模拟实验
3. 结果可视化和报告生成

### 长期（2周）

1. 开发CALIBRATION模块
2. 获取真实数据进行参数校准
3. 完成系统整体测试
4. 撰写研究报告和论文

---

## 项目总结

### 成功经验

1. **迭代开发有效**: 通过三个版本不断改进
2. **文档先行正确**: 详细需求文档避免返工
3. **简洁原则重要**: v3比v2更高效
4. **测试驱动可靠**: 15个测试保证质量
5. **性能优化必要**: Numba加速显著提升效率

### 经验教训

1. **避免过度设计**: v2的复杂度教训
2. **需求明确优先**: v1的失败原因
3. **渐进式开发**: 逐模块完成，避免大跃进
4. **参数调优重要**: 小参数变化带来大改善
5. **收敛性关键**: MFG模块的主要挑战

### 研究价值

1. **理论贡献**: MFG理论在劳动经济学的应用
2. **方法创新**: 基于个体的蒙特卡洛简化实现
3. **政策意义**: 为就业促进政策提供量化工具
4. **技术积累**: Python科学计算和高性能计算经验
---

**最后更新**: 2025-10-17
**当前版本**: Simulation_project_v3 (3.0-beta)
**开发状态**: 核心模块完成，收敛性优化中
